"ticket_id","title","type","priority","summary","acceptance_criteria","dependencies","estimated_effort","labels","status"
"STRW-001","Database migration: add stripe_session_id to orders table","Task","Critical","Add the stripe_session_id column to the existing orders table and create an index on it. This column links website orders to their Stripe Checkout session and serves as the idempotency key in the webhook handler. The column is non-unique because a single session can produce multiple order rows (one per sticker in the cart).","1. Migration file exists at supabase/migrations/add_stripe_session_id.sql; 2. Migration contains: ALTER TABLE orders ADD COLUMN IF NOT EXISTS stripe_session_id TEXT; 3. Migration contains: CREATE INDEX IF NOT EXISTS idx_orders_stripe_session_id ON orders(stripe_session_id); 4. Migration is idempotent — running it twice does not throw an error; 5. Column is NOT NULL-constrained to false so existing Etsy rows are unaffected; 6. Migration runs successfully against a local or staging Supabase instance with zero downtime; 7. The index is confirmed present via \\d orders in psql","None","XS","database,migration,backend","To Do"
"STRW-002","Scaffold Next.js 15 project with TypeScript, Tailwind CSS, and shadcn/ui","Task","Critical","Initialize the sticker-trendz-web repository with Next.js 15 (App Router, TypeScript), Tailwind CSS, and shadcn/ui. Establish the folder structure defined in the spec including app/, components/shop/, components/admin/, lib/, types/, and supabase/migrations/ directories. Configure next.config.ts for R2 image domains and set up .env.local.example with all required environment variable keys.","1. npx create-next-app@latest runs successfully with TypeScript, App Router, and Tailwind CSS flags; 2. shadcn/ui is initialized (npx shadcn-ui@latest init) and at least the Button and Card primitives are available; 3. Directory structure matches the spec exactly: app/(shop)/, app/(admin)/admin/, app/api/, components/shop/, components/admin/, lib/, types/, supabase/migrations/; 4. next.config.ts includes images.remotePatterns entry allowing the R2 CDN domain (read from NEXT_PUBLIC_R2_PUBLIC_URL); 5. .env.local.example contains all 8 required keys: NEXT_PUBLIC_SUPABASE_URL, SUPABASE_SERVICE_KEY, NEXT_PUBLIC_R2_PUBLIC_URL, NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY, STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, ADMIN_SECRET, NEXT_PUBLIC_BASE_URL; 6. npm run dev starts without errors; 7. npm run build completes without TypeScript errors","None","S","setup,scaffolding,frontend,infrastructure","To Do"
"STRW-003","Supabase client and shared TypeScript types","Task","Critical","Create the Supabase JS client singleton in lib/supabase.ts (server-side using SUPABASE_SERVICE_KEY) and define all shared TypeScript types in types/index.ts. Types must cover the stickers table, orders table, daily_metrics view, and the cart item shape used by Zustand. This is a foundational module that all server components and API routes will import.","1. lib/supabase.ts exports a createClient() helper (or singleton) using SUPABASE_SERVICE_KEY — it is never imported on the client; 2. types/index.ts exports Sticker interface matching all columns in the stickers table schema from the spec; 3. types/index.ts exports Order interface matching all columns in the orders table schema (including stripe_session_id); 4. types/index.ts exports DailyMetric interface matching all columns used by the admin dashboard (date, orders, gross_revenue, estimated_profit, new_listings, avg_order_value, cogs, etsy_fees); 5. types/index.ts exports CartItem interface with fields: stickerId, title, thumbnailUrl, price, quantity; 6. No TypeScript errors on tsc --noEmit; 7. SUPABASE_SERVICE_KEY is confirmed server-only — not prefixed with NEXT_PUBLIC_ and not imported in any client component","STRW-002","S","backend,database,types,infrastructure","To Do"
"STRW-004","Stripe client library and checkout session helper","Task","Critical","Create lib/stripe.ts initializing the Stripe Node SDK with STRIPE_SECRET_KEY. Export a typed createCheckoutSession helper that accepts validated cart items and returns a Stripe Checkout Session URL. This module is consumed by the POST /api/checkout route.","1. lib/stripe.ts initializes Stripe with STRIPE_SECRET_KEY and the correct API version; 2. Module is server-only — never imported in client components; 3. A createCheckoutSession function is exported that accepts an array of { stickerId, title, imageUrl, unitPrice, quantity } objects; 4. The function creates a Stripe Checkout session with mode: 'payment', shipping_address_collection enabled for US addresses, and free shipping; 5. The session's success_url points to NEXT_PUBLIC_BASE_URL/checkout/success?session_id={CHECKOUT_SESSION_ID}; 6. The session's cancel_url points back to NEXT_PUBLIC_BASE_URL/; 7. Each cart item becomes a line_item with name, images, unit_amount in cents, and quantity; 8. Session metadata includes a JSON-serialized cart summary (stickerId + quantity per item) for use in the webhook; 9. TypeScript compiles without errors","STRW-002","S","backend,stripe,payments,infrastructure","To Do"
"STRW-005","Zustand cart store with localStorage persistence","Task","Critical","Implement the client-side cart state in lib/cart.ts using Zustand with the persist middleware backed by localStorage. Export the useCartStore hook with actions for addItem, removeItem, updateQuantity, clearCart, and a computed cartTotal selector. This is used by CartDrawer, StickerCard, and the checkout flow.","1. Zustand store is created with persist middleware using localStorage key 'sticker-trendz-cart'; 2. Store state contains items: CartItem[] where CartItem has stickerId, title, thumbnailUrl, price, quantity; 3. addItem action: if sticker already in cart increments quantity by 1, otherwise appends new item; 4. removeItem action: removes item by stickerId; 5. updateQuantity action: sets quantity for a stickerId, removes item if quantity reaches 0; 6. clearCart action: resets items to []; 7. cartTotal selector returns sum of price * quantity for all items, rounded to 2 decimal places; 8. itemCount selector returns total quantity across all items; 9. Cart state survives full page reload — verified by adding an item and hard-refreshing; 10. No server-side import errors — store is client-only and wrapped in a check for window","STRW-002,STRW-003","S","frontend,cart,state-management","To Do"
"STRW-006","Admin middleware for route protection","Task","Critical","Implement Next.js middleware in app/middleware.ts (or middleware.ts at root) to protect all /admin/* routes except /admin/login. Middleware reads the admin_token HttpOnly cookie, validates its HMAC signature against ADMIN_SECRET, and redirects unauthenticated requests to /admin/login. This is a security-critical piece and must be correct before any admin pages are built.","1. middleware.ts matches the pattern /admin/:path* but excludes /admin/login; 2. GIVEN a request to any /admin/* route without an admin_token cookie WHEN middleware runs THEN the request is redirected to /admin/login with a 307 status; 3. GIVEN a request with a valid admin_token cookie WHEN middleware runs THEN the request passes through without redirect; 4. GIVEN a request with a tampered or expired admin_token cookie WHEN middleware runs THEN the request is redirected to /admin/login; 5. The admin_token cookie is validated using HMAC-SHA256 of (ADMIN_SECRET + timestamp); 6. Tokens older than 24 hours are rejected; 7. Middleware does not block any non-admin routes; 8. TypeScript compiles without errors","STRW-002","S","backend,auth,security,middleware","To Do"
"STRW-007","POST /api/admin/login — password validation and cookie issuance","Task","Critical","Implement the POST /api/admin/login API route. It receives a password from the login form, compares it to ADMIN_SECRET, and on success sets an HttpOnly admin_token cookie containing an HMAC-signed token with a 24-hour TTL. On failure it returns a 401 with an error message.","1. Route accepts POST with JSON body { password: string }; 2. GIVEN correct password WHEN POST /api/admin/login is called THEN response sets an HttpOnly, Secure, SameSite=Lax admin_token cookie and returns 200 with { success: true }; 3. GIVEN incorrect password WHEN POST /api/admin/login is called THEN response returns 401 with { error: 'Invalid password' } and does NOT set a cookie; 4. admin_token value is HMAC-SHA256(ADMIN_SECRET + current Unix timestamp in seconds); 5. Cookie expires in 24 hours; 6. Cookie has HttpOnly: true and Secure: true flags; 7. Missing password field in body returns 400; 8. Route is only accessible via POST — GET returns 405","STRW-002,STRW-006","S","backend,auth,api,security","To Do"
"STRW-008","Shop homepage — sticker grid with filter and sort","Story","Critical","Build the shop homepage at app/(shop)/page.tsx. It fetches all published and approved stickers from Supabase via a server component, then renders them in a responsive StickerGrid. Includes TierFilter (filter by pricing tier badge) and sort controls (newest / price ascending / price descending). Sets correct SEO metadata.","1. Page fetches stickers WHERE published_at IS NOT NULL AND moderation_status = 'approved' ORDER BY published_at DESC via Supabase server-side query; 2. Grid is responsive: 1 column on mobile (<640px), 2 columns on sm (640px+), 4 columns on lg (1024px+); 3. TierFilter component renders four filter buttons: Just Dropped, Trending, Cooling, Evergreen; selecting a tier filters the grid to only that tier; 4. A reset/All button clears the active tier filter; 5. Sort control allows switching between Newest (default), Price: Low to High, Price: High to Low; 6. Filter and sort can be combined (e.g. Trending + Price ascending); 7. GIVEN no stickers match the active filter THEN an empty state message 'No stickers found' is shown with a reset filter button; 8. Page <title> is 'Sticker Trendz — Trending Stickers, Delivered'; 9. Page <meta description> is set; 10. Each StickerCard shows thumbnail, title, tier badge, and price; 11. Page renders correctly with no stickers in DB (empty catalog)","STRW-003,STRW-009,STRW-010,STRW-011","M","frontend,shop,ui","To Do"
"STRW-009","StickerCard and TierBadge components","Task","High","Build the StickerCard component (components/shop/StickerCard.tsx) and TierBadge component (components/shop/TierBadge.tsx). StickerCard renders the sticker thumbnail, title, tier badge, and price. It links to the product detail page and includes an Add to Cart button that calls the Zustand cart store. TierBadge maps pricing_tier values to colored pill labels per the spec color table.","1. StickerCard renders thumbnail_url as a Next.js <Image> with proper width/height and alt text; 2. StickerCard shows sticker title, formatted price (e.g. $4.49), and TierBadge; 3. StickerCard links to /stickers/[id]; 4. Add to Cart button calls cartStore.addItem() with correct CartItem shape; 5. TierBadge renders correct label and background color per spec: just_dropped=red/orange, trending=blue, cooling=slate, evergreen=green; 6. TierBadge is accessible — color is not the only indicator (label text is always present); 7. StickerCard handles missing thumbnail_url gracefully (fallback placeholder image or the image_url); 8. Components are TypeScript-typed with no implicit any","STRW-003,STRW-005","S","frontend,shop,ui,components","To Do"
"STRW-010","TierFilter and sort controls component","Task","High","Build the TierFilter (components/shop/TierFilter.tsx) component that emits the selected tier up to the parent shop page. Also build inline sort controls on the shop page. These are client components since they manage interactive filter state.","1. TierFilter renders five options: All (default), Just Dropped, Trending, Cooling, Evergreen; 2. Active tier is visually highlighted (e.g. filled button vs outlined); 3. Selecting a tier calls an onFilterChange callback with the tier string; 4. Clicking the active tier again or clicking 'All' resets to no filter; 5. Sort control renders a <select> or button group with options: Newest, Price: Low to High, Price: High to Low; 6. Filter and sort state are managed in the parent page (or via URL search params for shareability); 7. Filter and sort controls are keyboard accessible (Tab + Enter/Space); 8. Components are marked 'use client' appropriately","STRW-002","S","frontend,shop,ui,components","To Do"
"STRW-011","Product detail page — /stickers/[id]","Story","High","Build the product detail page at app/(shop)/stickers/[id]/page.tsx. Fetches a single sticker by ID server-side from Supabase. Renders full image, title, description, size info, tier badge, sales count, and price. Includes Add to Cart button. Returns 404 for unknown or unpublished sticker IDs. Sets Open Graph meta tags for social sharing.","1. Page fetches sticker by ID server-side where id = params.id AND published_at IS NOT NULL AND moderation_status = 'approved'; 2. GIVEN invalid or unpublished sticker ID WHEN page renders THEN Next.js notFound() is called, rendering the custom 404 page; 3. Full-resolution image_url is rendered as the hero image using Next.js <Image>; 4. Page shows sticker title, description, size (e.g. '3in'), pricing_tier badge, sales_count (e.g. '42 sold'), and formatted price; 5. Add to Cart button adds the sticker to the Zustand cart with correct CartItem data; 6. <title> is '{sticker.title} — Sticker Trendz'; 7. og:title is set to sticker.title; 8. og:image is set to the sticker's image_url; 9. og:description is set to sticker.description (truncated to 160 chars if needed); 10. Page is statically generated at build time for known IDs with revalidation (or ISR); 11. Navigating back from the product page preserves cart state","STRW-003,STRW-005,STRW-009","M","frontend,shop,ui,seo","To Do"
"STRW-012","Cart drawer component","Story","High","Build the CartDrawer component (components/shop/CartDrawer.tsx) as a slide-over side panel. It reads from the Zustand cart store and displays all cart items with quantity controls, per-item prices, and cart total. Includes a Checkout button that POSTs to /api/checkout. Cart state persists across page navigations and reloads.","1. CartDrawer renders as a slide-over panel from the right side of the screen; 2. CartDrawer shows each cart item with: thumbnail, title, quantity controls (- / count / +), unit price, and line total (unit price × quantity); 3. Remove button (or decrement to 0) removes the item from the cart; 4. Cart total is displayed at the bottom: sum of all line totals formatted as currency; 5. GIVEN empty cart WHEN CartDrawer is open THEN an empty state message is shown (e.g. 'Your cart is empty'); 6. Checkout button is disabled when cart is empty; 7. Clicking Checkout POSTs to /api/checkout with the current cart items and redirects to the Stripe Checkout URL on success; 8. GIVEN checkout API returns an error THEN a toast error message is displayed and the cart is preserved (not cleared); 9. Cart item count badge is shown on the cart icon in the site header; 10. CartDrawer can be opened/closed with a toggle; 11. CartDrawer is accessible — focus is trapped inside when open, Esc closes it","STRW-005,STRW-009","M","frontend,shop,cart,ui","To Do"
"STRW-013","POST /api/checkout — create Stripe Checkout session with cart validation","Task","Critical","Implement the POST /api/checkout API route. It receives the cart from the client, re-fetches all sticker prices from Supabase (never trusts client-side prices), validates that all stickers are still published and approved, then creates a Stripe Checkout session. Returns the session URL for client-side redirect.","1. Route accepts POST with JSON body { items: Array<{ stickerId: string, quantity: number }> }; 2. GIVEN empty items array WHEN POST /api/checkout is called THEN returns 400 with error 'Cart is empty'; 3. Route fetches all sticker records for the provided IDs from Supabase using the service key; 4. GIVEN any sticker ID not found in DB THEN returns 400 with error listing the invalid sticker IDs; 5. GIVEN any sticker where published_at IS NULL or moderation_status != 'approved' THEN returns 400 with error listing the unavailable sticker titles; 6. Prices used for the Stripe session come from stickers.price in the DB — client-supplied prices are ignored; 7. GIVEN all validation passes THEN creates a Stripe Checkout session with one line_item per sticker; 8. Session metadata contains JSON-serialized array of { stickerId, quantity, unitPrice, fulfillmentProvider, pricingTier }; 9. shipping_address_collection is enabled for US (country restriction matches spec non-goal of no international shipping); 10. customer_email collection is enabled in Stripe session; 11. Returns 200 with { url: string } pointing to Stripe hosted checkout; 12. Returns 500 with generic error if Stripe session creation fails","STRW-003,STRW-004","M","backend,api,stripe,payments","To Do"
"STRW-014","Order success page — /checkout/success","Story","High","Build the order success page at app/(shop)/checkout/success/page.tsx. This page is navigated to after a successful Stripe payment. It reads the session_id from the URL query param, optionally fetches the session from Stripe to confirm payment status, and displays a friendly confirmation message with the order reference.","1. Page reads session_id from URL query params (e.g. ?session_id=cs_abc123); 2. GIVEN a valid session_id WHEN page loads THEN a success message is displayed: order confirmed, thank you copy, and the Stripe session ID as an order reference; 3. GIVEN missing or malformed session_id WHEN page loads THEN page shows a generic confirmation message (not an error — customer may have completed payment); 4. Page includes a 'Continue Shopping' link back to /; 5. Page title is 'Order Confirmed — Sticker Trendz'; 6. No sensitive customer data is displayed on this client-accessible page; 7. Page does NOT trigger any order creation logic (that is handled by the webhook); 8. Cart is cleared (cartStore.clearCart() called) after landing on this page so customer does not accidentally re-checkout","STRW-005,STRW-013","S","frontend,shop,payments","To Do"
"STRW-015","Custom 404 not-found page","Task","Medium","Build the custom 404 page at app/not-found.tsx. This is rendered by Next.js when notFound() is called from any page (e.g. product detail for invalid sticker ID) or when a route simply does not match. Includes a friendly message and a link back to the shop homepage.","1. app/not-found.tsx exists and exports a default React component; 2. Page renders a clear 404 / page not found message; 3. Page includes a link to / (back to shop) labeled 'Back to Shop' or similar; 4. Page applies the same site layout (header, consistent styling) as the rest of the site; 5. Navigating to /stickers/invalid-uuid renders this 404 page; 6. Navigating to any completely unknown route (e.g. /foo/bar) renders this 404 page; 7. Page title is '404 — Sticker Trendz'","STRW-002","XS","frontend,ui","To Do"
"STRW-016","POST /api/webhooks/stripe — idempotent order writing to Supabase","Task","Critical","Implement the Stripe webhook handler at app/api/webhooks/stripe/route.ts. It receives checkout.session.completed events from Stripe, verifies the webhook signature, checks idempotency against the orders table, writes one order row per cart item, increments sales_count on each sticker, and optionally triggers a REFRESH of the daily_metrics materialized view.","1. Route accepts POST with raw body (not parsed JSON) — required for Stripe signature verification; 2. Stripe webhook signature is verified using stripe.webhooks.constructEvent(rawBody, signature, STRIPE_WEBHOOK_SECRET) — unverified requests return 400; 3. Handler only processes checkout.session.completed events — other event types return 200 immediately; 4. Idempotency check: query orders WHERE stripe_session_id = session.id — if rows exist return 200 immediately without inserting; 5. GIVEN a new session WHEN webhook fires THEN one order row is inserted per cart item from session metadata; 6. Each order row is populated per the Order Record spec: stripe_session_id, sticker_id, quantity, unit_price, total_amount, fulfillment_provider, status='pending', pricing_tier_at_sale, customer_data (name, email, shipping address from Stripe session); 7. After order insert, sales_count on each affected sticker is incremented by the ordered quantity using Supabase RPC or UPDATE; 8. GIVEN Stripe retries the same webhook THEN idempotency check prevents duplicate rows; 9. GIVEN webhook for a multi-sticker cart (e.g. 2 stickers) THEN exactly 2 order rows are written, all sharing the same stripe_session_id; 10. GIVEN order insert fails THEN returns 500 so Stripe will retry; 11. Handler executes REFRESH MATERIALIZED VIEW CONCURRENTLY daily_metrics after successful insert (or logs a warning if it fails without blocking the 200 response)","STRW-001,STRW-003,STRW-004","L","backend,api,stripe,webhooks,database","To Do"
"STRW-017","Admin login page — /admin/login","Story","High","Build the admin login page at app/(admin)/admin/login/page.tsx. Renders a centered password form. On submit, POSTs to /api/admin/login. On success, redirects to /admin. On failure, shows an inline error message. This page must be excluded from the admin middleware route guard.","1. Page renders a centered password input form with a submit button; 2. Page title is 'Admin Login — Sticker Trendz'; 3. Password input uses type='password' so value is masked; 4. GIVEN correct password WHEN form is submitted THEN client receives 200, admin_token cookie is set, and user is redirected to /admin; 5. GIVEN incorrect password WHEN form is submitted THEN an inline error message 'Invalid password' is displayed below the form; 6. Submit button shows a loading state while the POST request is in flight; 7. Page is excluded from the middleware route guard (so unauthenticated users can access it); 8. GIVEN user is already authenticated (has valid cookie) WHEN visiting /admin/login THEN user is redirected to /admin; 9. Form prevents multiple submissions while loading (button disabled during fetch)","STRW-006,STRW-007","S","frontend,admin,auth,ui","To Do"
"STRW-018","Admin dashboard — /admin (revenue metrics and charts)","Story","High","Build the admin dashboard at app/(admin)/admin/page.tsx. Fetches the last 30 days of data from the daily_metrics materialized view. Displays summary metric cards (revenue today, this week, this month, orders count, new listings, AOV) and a revenue/profit chart over time. Protected by middleware.","1. Page fetches SELECT * FROM daily_metrics ORDER BY date DESC LIMIT 30 server-side using the Supabase service key; 2. Summary cards display: Revenue Today, Revenue This Week, Revenue This Month, Total Orders (this month), New Listings (today), Average Order Value; 3. All monetary values are formatted as currency (e.g. $1,234.56); 4. A line or bar chart visualizes gross_revenue and estimated_profit over the last 30 days with date on the X-axis; 5. GIVEN daily_metrics view returns no rows THEN all metric cards show $0.00 or 0 and the chart renders empty gracefully; 6. Skeleton loading states are shown while data is fetching (for client-fetched segments); 7. Page title is 'Admin Dashboard — Sticker Trendz'; 8. Navigation links to /admin/orders and /admin/stickers are present; 9. Page is inaccessible without a valid admin_token cookie — middleware redirects to /admin/login","STRW-006,STRW-003,STRW-019,STRW-020","L","frontend,admin,dashboard,ui","To Do"
"STRW-019","MetricsCard and RevenueChart admin components","Task","Medium","Build reusable admin UI components: MetricsCard (components/admin/MetricsCard.tsx) for displaying a single KPI with label and formatted value, and RevenueChart (components/admin/RevenueChart.tsx) for rendering the daily revenue and profit line chart using a charting library (e.g. Recharts or shadcn/ui Charts).","1. MetricsCard accepts props: title (string), value (string | number), prefix ('$' | '' ), and renders a card with label and formatted value; 2. MetricsCard has a skeleton loading variant (when isLoading prop is true); 3. RevenueChart accepts props: data (DailyMetric[]) and renders a line chart with two series: gross_revenue and estimated_profit; 4. RevenueChart X-axis displays formatted dates (e.g. 'Feb 14'); 5. RevenueChart Y-axis displays dollar amounts; 6. Chart is responsive (fills its container width); 7. GIVEN empty data array WHEN RevenueChart renders THEN it shows a 'No data available' message rather than a broken chart; 8. Both components are TypeScript-typed and accept className for styling overrides","STRW-003","S","frontend,admin,ui,components","To Do"
"STRW-020","Admin orders page — /admin/orders","Story","High","Build the admin orders page at app/(admin)/admin/orders/page.tsx. Fetches all orders from Supabase (joining stickers for the sticker title) and renders them in a paginated or scrollable table showing order ID, sticker name, quantity, amount, status, fulfillment provider, and created_at. Covers both Etsy and website orders.","1. Page fetches orders joined with stickers (for title) from Supabase using the service key, ordered by created_at DESC; 2. Table columns: Order ID (truncated UUID or etsy_order_id), Sticker, Qty, Amount, Status, Fulfillment Provider, Date; 3. Status values are color-coded (e.g. pending=yellow, shipped=green, refunded=red); 4. Both website orders (stripe_session_id set) and Etsy orders (etsy_order_id set) appear in the same table; 5. GIVEN 0 orders in DB THEN empty state message 'No orders yet' is shown; 6. Skeleton table rows are shown while data loads; 7. Table is horizontally scrollable on mobile; 8. Page title is 'Orders — Sticker Trendz Admin'; 9. Page is protected by admin middleware","STRW-006,STRW-003,STRW-021","M","frontend,admin,ui","To Do"
"STRW-021","OrdersTable admin component","Task","Medium","Build the OrdersTable component (components/admin/OrdersTable.tsx) used by the admin orders page. It accepts a typed array of order rows (joined with sticker title) and renders a styled table with color-coded status badges.","1. OrdersTable accepts orders prop typed as Array<Order & { sticker_title: string }>; 2. Renders a <table> or shadcn/ui Table with correct column headers; 3. Status column renders a colored badge: pending=yellow, shipped=green, refunded=red, other=gray; 4. Amount column renders values as currency (e.g. $4.49); 5. Date column renders created_at as a human-readable relative or absolute date; 6. Order ID column truncates UUID to first 8 chars with a title tooltip showing the full ID; 7. Component has a skeleton loading variant (isLoading prop renders ghost rows); 8. Component is TypeScript-typed with no implicit any","STRW-003","S","frontend,admin,ui,components","To Do"
"STRW-022","Admin inventory page — /admin/stickers","Story","Medium","Build the admin inventory page at app/(admin)/admin/stickers/page.tsx. Fetches all published stickers from Supabase and renders a table showing thumbnail, title, sales_count, current_pricing_tier, price, and created_at. This gives the admin a view of active inventory without leaving the app.","1. Page fetches stickers WHERE published_at IS NOT NULL from Supabase using service key, ordered by created_at DESC; 2. Table columns: Thumbnail, Title, Sales Count, Tier, Price, Published Date; 3. Thumbnail renders as a small Next.js <Image> (e.g. 40×40px); 4. Tier column renders a TierBadge component; 5. Price column renders as currency (e.g. $4.49); 6. GIVEN 0 published stickers THEN empty state 'No published stickers' is shown; 7. Skeleton loading state is shown while data loads; 8. Table is sortable by sales_count and price (client-side sort); 9. Page title is 'Inventory — Sticker Trendz Admin'; 10. Page is protected by admin middleware","STRW-006,STRW-003,STRW-009","M","frontend,admin,ui","To Do"
"STRW-023","Loading skeletons for shop grid and product detail","Task","Medium","Implement skeleton loading states for the shop homepage and product detail page. The shop grid skeleton should render shimmer placeholder cards matching the responsive grid layout. The product detail skeleton should match the hero image + text layout. These improve perceived performance during Supabase data fetching.","1. StickerGrid renders skeleton cards (using Suspense boundary or loading.tsx) that match the 1/2/4 column responsive grid layout; 2. Skeleton cards have shimmer animation (pulse or gradient sweep); 3. Skeleton cards approximate the dimensions of a real StickerCard (aspect ratio, text lines); 4. Product detail page has a loading.tsx or Suspense fallback that skeletons the hero image area and text fields; 5. Skeletons disappear and are replaced by real content once data loads; 6. No layout shift occurs when real content replaces skeletons (dimensions are stable)","STRW-008,STRW-011","S","frontend,shop,ui,performance","To Do"
"STRW-024","Loading skeletons for admin tables and dashboard","Task","Medium","Implement skeleton loading states for all three admin pages (dashboard, orders, inventory). Dashboard skeleton covers metric cards and the chart area. Table skeletons render ghost rows in place of real data rows.","1. Admin dashboard shows skeleton MetricsCards (gray rectangle placeholders) while data loads; 2. RevenueChart area shows a skeleton placeholder while data loads; 3. Admin orders table shows 5 ghost skeleton rows while data loads; 4. Admin inventory table shows 5 ghost skeleton rows while data loads; 5. Skeletons use consistent shimmer animation matching the shop skeletons; 6. Real content replaces skeletons without layout shift","STRW-018,STRW-020,STRW-022","S","frontend,admin,ui,performance","To Do"
"STRW-025","Error states and toast notifications","Task","Medium","Implement error handling UI across the storefront: checkout API error toast, filter empty state message, and general error boundary. Use shadcn/ui Toast (Sonner or Radix) for transient error messages. Ensure the checkout error preserves the cart state.","1. Installing and configuring shadcn/ui Toast component (or Sonner) is complete and a <Toaster /> is rendered in app/layout.tsx; 2. GIVEN POST /api/checkout returns a non-200 response THEN a toast error message is shown (e.g. 'Some items are no longer available') and the cart is NOT cleared; 3. GIVEN a sticker becomes unavailable between cart add and checkout THEN the error message identifies which item is unavailable; 4. Empty filter state on shop grid shows 'No stickers found' inline message with a 'Reset filters' button that clears the active tier filter; 5. A React error boundary wraps the main shop grid so a data-fetching failure shows a friendly 'Something went wrong' message instead of a blank page; 6. All error messages are user-friendly (no stack traces or raw error objects exposed to users)","STRW-008,STRW-012,STRW-013","S","frontend,ui,error-handling","To Do"
"STRW-026","SEO metadata and Open Graph tags","Task","Medium","Ensure every page has correct <title>, <meta description>, and where applicable Open Graph tags implemented via the Next.js Metadata API. Cover: shop homepage, product detail (with dynamic OG image), order success page, 404 page, and all admin pages.","1. Shop homepage exports metadata with title: 'Sticker Trendz — Trending Stickers, Delivered' and a descriptive meta description; 2. Product detail page exports generateMetadata() that returns title: '{sticker.title} — Sticker Trendz', openGraph.title, openGraph.description (truncated at 160 chars), and openGraph.images pointing to sticker.image_url; 3. Order success page has title: 'Order Confirmed — Sticker Trendz'; 4. 404 page has title: '404 Not Found — Sticker Trendz'; 5. Admin pages have titles following pattern '{Page} — Sticker Trendz Admin' and a noindex meta robots tag; 6. OG tags for product detail render correctly when tested with https://opengraph.xyz; 7. No page is missing a <title> tag","STRW-008,STRW-011,STRW-014,STRW-015","S","frontend,seo,metadata","Done"
"STRW-027","Site layout, header, and navigation shell","Task","High","Build the root app/layout.tsx with a consistent site shell including a sticky header with the Sticker Trendz logo/brand name, a cart icon with item count badge (wired to Zustand), and global styles. Also build the admin layout that wraps all /admin/* pages with a simple nav sidebar or top bar.","1. app/layout.tsx wraps all pages with a <html>, <body>, global Tailwind styles, and the <Toaster /> component; 2. A site header renders the brand name 'Sticker Trendz' linking to /, and a cart icon button that opens the CartDrawer; 3. Cart icon shows a badge with the current itemCount from the Zustand store (hidden when cart is empty); 4. Header is sticky (stays visible on scroll) and responsive; 5. Admin pages use a separate layout (app/(admin)/layout.tsx) with a simple nav containing links to /admin, /admin/orders, /admin/stickers, and a site-level title 'Admin'; 6. Admin layout does not show the customer-facing cart header; 7. Global font is applied consistently across all pages; 8. Layout renders without hydration mismatch warnings in the browser console","STRW-005,STRW-012","M","frontend,ui,layout","To Do"
"STRW-028","Vercel deployment and environment variable configuration","Task","High","Deploy the application to Vercel. Configure all required environment variables in the Vercel project settings. Register the Stripe webhook endpoint pointing to the production domain. Verify R2 CORS configuration. Run the database migration on production Supabase.","1. Project is connected to Vercel via GitHub integration with automatic preview deploys on PRs; 2. All 8 environment variables from .env.local.example are set in Vercel project settings for the Production environment; 3. STRIPE_WEBHOOK_SECRET is set to the signing secret from the registered Stripe webhook endpoint; 4. Stripe webhook is registered at https://<domain>/api/webhooks/stripe for the checkout.session.completed event; 5. R2 bucket CORS policy allows GET requests from the Vercel production domain and Vercel preview URL patterns (*.vercel.app); 6. stripe_session_id migration (STRW-001) has been run on production Supabase; 7. npm run build succeeds on Vercel (no TypeScript or build errors); 8. Production URL loads the shop page with live sticker data from Supabase","STRW-001,STRW-016,STRW-017,STRW-018,STRW-020,STRW-022,STRW-025,STRW-026,STRW-027","M","devops,deployment,infrastructure","To Do"
"STRW-029","End-to-end verification and smoke testing","Task","High","Manually verify all checklist items from the spec's Verification Checklist section against the deployed Vercel preview URL. Document results. Fix any blocking issues found. This ticket is the final acceptance gate before considering the storefront launch-ready.","1. npm run dev starts and shop renders sticker data from Supabase (local); 2. Mobile layout verified in browser devtools: 1 column at <640px, 2 at sm, 4 at lg; 3. Product detail for an invalid sticker ID returns the custom 404 page; 4. Cart add/remove/quantity adjustment persists across hard page reload (localStorage confirmed in DevTools); 5. Checkout with a sticker that became unpublished between cart and checkout returns a user-visible error; 6. Stripe test-mode checkout completes → orders rows written to Supabase with status=pending and stripe_session_id set; 7. Delivering the same Stripe webhook twice → no duplicate order rows in Supabase; 8. Multi-sticker cart (2+ stickers) → correct number of order rows with shared stripe_session_id; 9. /admin/login rejects wrong password and accepts correct password setting the cookie; 10. /admin without cookie redirects to /admin/login; 11. /admin shows correct revenue figures matching daily_metrics data; 12. OG tags validated at https://opengraph.xyz for a product detail URL; 13. All tests repeated against the Vercel preview URL","STRW-028","M","qa,testing,deployment","To Do"
